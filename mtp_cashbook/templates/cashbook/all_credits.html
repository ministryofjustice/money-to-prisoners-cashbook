{% extends 'cashbook/credits_base.html' %}
{% load i18n %}
{% load mtp_common %}

{% block body_classes %}{{ block.super }} mtp-credits{% endblock %}

{% block page_content %}

  <header>
    {% language_switch %}
    <h1 class="heading-xlarge">{{ view.title }}</h1>
  </header>

  {% include 'mtp_common/includes/message_box.html' %}

  {% if form.is_valid %}
    <p class="mtp-all-credits__description">{{ form.get_search_description }}</p>
  {% endif %}

  {% random_string as filter_box_id %}
  <div class="grid-row print-hidden">
    <div class="column-two-thirds">
      <p class="mtp-filter-box__control">
        <a href="#" aria-controls="mtp-filter-box__contents-{{ filter_box_id }}" aria-expanded="{% if form.is_valid %}false{% else %}true{% endif %}" role="button">
          <span></span>
          {% trans 'Filter these credits' %}
        </a>
      </p>

      <div class="panel panel-border-narrow mtp-filter-box__contents print-hidden" id="mtp-filter-box__contents-{{ filter_box_id }}">
        <form method="get" action="">
          {% include 'mtp_common/forms/error-summary.html' with form=form only %}

          {% include 'mtp_common/forms/field.html' with field=form.start value=form.start.value|date:'d/m/Y'|default:form.start.value|default_if_none:'' only %}
          {% include 'mtp_common/forms/field.html' with field=form.end value=form.end.value|date:'d/m/Y'|default:form.end.value|default_if_none:'' only %}

          <div class="form-group">
            {# forces a search to start on page 1, copy search terms from header #}
            <input type="hidden" name="{{ form.page.html_name }}" value="1">
            <input type="hidden" name="{{ form.search.html_name }}" value="{{ form.search.value|default_if_none:'' }}">
            <input class="button" type="submit" value="{% trans 'Filter list' %}">
          </div>
        </form>
      </div>
    </div>

    <div class="column-one-third" style="text-align:right">
      {% if credits_returned %}
        <p><a href="#print-dialog" class="js-Dialog">{% trans 'Print this page of credits' %}</a></p>
        {% include 'cashbook/includes/nomis_print_dialog.html' %}
      {% endif %}
    </div>
  </div>

  {% if credits_returned %}
    <div class="mtp-batch">
      {% if new_credit_list %}
        <h2 class="heading-medium">{% trans 'New credits' %}</h2>
        <table>
          <thead>
            {% include 'cashbook/includes/credits-header-row.html' with form=form include_status=False only %}
          </thead>

          <tbody>
            {% for credit in new_credit_list %}
              {% include 'cashbook/includes/credit-row.html' with credit=credit include_status=False only %}
            {% endfor %}
          </tbody>
        </table>
      {% endif %}

      {% if old_credit_list %}
        <h2 class="heading-medium">{% trans 'Processed credits' %}</h2>
        <table>
          <thead>
            {% include 'cashbook/includes/credits-header-row.html' with form=form include_status=True pre_approval_required=pre_approval_required only %}
          </thead>

          <tbody>
            {% for credit in old_credit_list %}
              {% include 'cashbook/includes/credit-row.html' with credit=credit include_status=True pre_approval_required=pre_approval_required only %}
            {% endfor %}
          </tbody>
        </table>
      {% endif %}

      {% page_list page=current_page page_count=page_count query_string=form.query_string %}
    </div>
  {% endif %}

{% endblock %}
