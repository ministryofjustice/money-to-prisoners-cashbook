{% extends 'disbursements/base.html' %}
{% load i18n %}
{% load mtp_common %}
{% load disbursements %}

{% block inner_content %}
  <header>
    {% language_switch %}
    <h1 class="heading-xlarge__chopped">Search for "{{ search_term }}"</h1>
  </header>

  <h3 class="heading-medium">Showing {{ disbursements|length }} disbursements</h3>

  <div class="grid-row print-hidden">
    <div class="column-two-thirds">
      <p>
        <a class="mtp-disclosure" href="#" aria-controls="mtp-filter-box" aria-expanded="{% if form.is_valid %}false{% else %}true{% endif %}" role="button" data-analytics="pageview,/-help_open/{{ request.resolver_match.url_name }}/">
          <span></span>{% trans 'Filter these credits' %}
        </a>
      </p>

      <div class="mtp-filter-box mtp-disclosure__contents panel panel-border-narrow print-hidden" id="mtp-filter-box">
        <form method="get" action="">
          {% include 'mtp_common/forms/error-summary.html' with form=form only %}

          {% include 'mtp_common/forms/field.html' with field=form.start value=form.start.value|date:'d/m/Y'|default:form.start.value|default_if_none:'' only %}
          {% include 'mtp_common/forms/field.html' with field=form.end value=form.end.value|date:'d/m/Y'|default:form.end.value|default_if_none:'' only %}

          <div class="form-group mtp-search-filter__submit">
            {# forces a search to start on page 1, copy search terms from header #}
            <input type="hidden" name="{{ form.page.html_name }}" value="1">
            <input type="hidden" name="{{ form.search.html_name }}" value="{{ form.search.value|default_if_none:'' }}">
            <input class="button" type="submit" value="{% trans 'Filter list' %}">
          </div>
        </form>
      </div>
    </div>

    <div class="column-one-third">
      <p style="text-align:right"><a href="#" class="print-hidden js-print-trigger">{% trans 'Print these disbursements' %}</a></p>
    </div>
  </div>

  <table class="mtp-processed-disbursements">
    <thead>
      <tr>
        <th>{% trans 'Date' %}</th>
        <th>{% trans 'Recipient' %}</th>
        <th>{% trans 'Address' %}</th>
        <th class="number">{% trans 'Amount' %}</th>
        <th>{% trans 'Prisoner' %}</th>
        <th>{% trans 'Status' %}</th>
      </tr>
    </thead>
    <tbody>
      {% for disbursement in disbursements %}
        <tr>
          <td>
            {{ disbursement.date }}
          </td>
          <td>
            <div class="mtp-disbursement-label">{% trans 'Name' %}</div>
            <div>{{ disbursement.name|default_if_none:'—' }}</div>
            <br/>

            <div class="mtp-disbursement-label">{% trans 'Account number' %}</div>
            <div>{{ disbursement.account_number|default_if_none:'—' }}</div>
            <br/>

            <div class="mtp-disbursement-label">{% trans 'Sort code' %}</div>
            <div>{{ disbursement.sort_code|default_if_none:'—' }}</div>
            <br/>

            {% if disbursement.email %}
              <div class="mtp-disbursement-label">{% trans 'Email' %}</div>
              <div>{{ disbursement.email|default_if_none:'—' }}</div>
            {% endif %}
          </td>
          <td>
            <div class="mtp-disbursement-label">{% trans 'Address' %}</div>
            <div>{{ disbursement.address.line1|default_if_none:'—' }}</div>
            <div>{{ disbursement.address.line2|default_if_none:'—' }}</div>
            <div>{{ disbursement.address.city|default_if_none:'—' }}</div>
            <div>{{ disbursement.address.postcode|default_if_none:'—' }}</div>
          </td>
          <td class="number">
            <div class="mtp-disbursement-label">{% trans 'Amount' %}</div>
            <div>{{ disbursement.amount }}</div>
            <br/>
            <div class="mtp-disbursement-label">{% trans 'Account' %}</div>
            <div>{{ disbursement.account|accountlabel }}</div>
          </td>
          <td>
            <div class="mtp-disbursement-label">{% trans 'Number' %}</div>
            <div>{{ disbursement.prisoner_number|default_if_none:'—' }}</div>
            <br/>

            <div class="mtp-disbursement-label">{% trans 'Name' %}</div>
            <div>{{ disbursement.prisoner_name|default_if_none:'—' }}</div>
            <br/>
          </td>
          <td>
            <div class="mtp-disbursement-label">{% trans 'Processed by' %}</div>
            <div>{{ disbursement.processed_by|default_if_none:'—' }}</div>
            <br/>

            <div class="mtp-disbursement-label">{% trans 'NOMIS ID' %}</div>
            <div>{{ disbursement.nomis_transaction_id|default_if_none:'—' }}</div>
            <br/>
          </td>
        </tr>
      {% empty %}
        <tr class="no-border">
          <td colspan="6">{% trans 'No matching credits found' %}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}
